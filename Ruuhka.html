<!DOCTYPE html>
<html>
<head>
<title>RUUHKA</title>
<style>

  body {
    -webkit-user-select: none;
    user-select: none;
    cursor: default;
    padding-right: 10px;
    cursor: not-allowed;
  }

  table {
    max-width: 1200px;
  }

  td {
    vertical-align: top;
  }

  svg {
    position: relative;
    left: -30px;
    cursor: not-allowed;
  }

  #game {
    cursor: default;
  }

  .c0 { opacity: 0; }
  .c1 { fill: dodgerblue; }
  .c2 { fill: Cyan; }
  .c3 { fill: Lime; }
  .c4 { fill: Yellow; }
  .c5 { fill: Red; }
  .c6 { fill: Magenta; }

  .place { opacity: 0; }
  .place-weak { fill-opacity: 0; stroke: gray; stroke-width 1; }
  .place-strong { fill-opacity: 0; stroke: white; stroke-width 1; }

  .pressed {
    font-size: 24px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    color: white;
    background-color: darkblue;
    border: inset;
    border-radius: 20px;
    margin: 20px;
    cursor: default;
  }

  .selected {
    font-size: 24px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    color: white;
    background-color: darkblue;
    border: outset;
    border-radius: 20px;
    margin: 20px;
    cursor: default;
  }

  .used {
    font-size: 24px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    color: white;
    background-color: darkblue;
    border: outset;
    border-radius: 20px;
    margin: 20px;
    cursor: not-allowed;
  }

  .enabled {
    font-size: 24px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    color: white;
    background-color: blue;
    border: outset;
    border-radius: 20px;
    margin: 20px;
    cursor: default;
  }

  .disabled {
    font-size: 24px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 3px;
    color: gray;
    background-color: lightgrey;
    border: outset;
    border-radius: 20px;
    margin: 20px;
    cursor: not-allowed;
  }

  .askel-box {
    margin-right: 30px;
    float: left;
  }

  .askel-enabled {
    font-size: 24px;
    text-align: center;
    padding: 10px;
    color: white;
    background-color: blue;
    border: outset;
    border-radius: 20px;
    cursor: default;
    float: left;
  }

  .askel-pressed {
    font-size: 24px;
    text-align: center;
    padding: 10px;
    color: white;
    background-color: blue;
    border: inset;
    border-radius: 20px;
    cursor: default;
    float: left;
  }

  .askel-disabled {
    font-size: 24px;
    text-align: center;
    padding: 10px;
    color: gray;
    background-color: lightgrey;
    border: outset;
    border-radius: 20px;
    cursor: not-allowed;
    float: left;
  }

  #count {
    vertical-align: middle;
    font-family: monospace;
    font-size: 40px;
    text-align: right;
    min-width: 80px;
    padding: 10px;
  }

  .valmis-hidden {
    opacity: 0;
    cursor: default;
  }     

  .valmis-shown {
    opacity: 1;
    cursor: not-allowed;
  }     

</style>
</head>
<body>
<table>
<tr>
<td>
<svg width="745" height="600">
<g id="game">
  <circle cx="550" cy="40" r="38" fill="black" />
  <circle id="g1" cx="550" cy="40" r="32" stroke="black" stroke-width="8"
      class="c1" />

  <circle cx="700" cy="300" r="38" fill="black" />
  <circle id="g2" cx="700" cy="300" r="32" stroke="black" stroke-width="8"
      class="c2" />

  <circle cx="550" cy="560" r="38" fill="black" />
  <circle id="g3" cx="550" cy="560" r="32" stroke="black" stroke-width="8"
      class="c3" />

  <circle cx="250" cy="560" r="38" stroke="black" />
  <circle id="g4" cx="250" cy="560" r="32" stroke="black" stroke-width="8"
      class="c4" />

  <circle cx="100" cy="300" r="38" stroke="black" />
  <circle id="g5" cx="100" cy="300" r="32" stroke="black" stroke-width="8"
      class="c5" />

  <circle cx="250" cy="40" r="38" stroke="black" />
  <circle id="g6" cx="250" cy="40" r="32" stroke="black" stroke-width="8"
      class="c6" />

  <polygon points="540,58 680,300 540,542 260,542 120,300 260,58"
      style="fill:black;" />

  <text id="valmis" x="310" y="315"
      fill="black" font-size="300%">VALMIS</text>

  <polygon id="m0" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m1" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m2" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m3" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m4" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m5" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m6" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m7" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m8" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m9" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m10" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m11" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m12" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m13" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m14" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m15" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m16" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m17" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m18" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m19" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m20" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m21" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m22" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m23" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m24" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m25" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m26" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m27" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m28" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m29" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m30" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m31" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m32" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m33" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m34" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m35" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m36" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m37" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m38" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m39" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m40" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m41" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m42" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m43" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m44" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m45" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m46" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m47" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m48" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m49" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m50" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m51" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m52" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m53" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m54" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m55" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m56" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m57" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m58" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m59" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m60" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m61" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m62" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m63" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m64" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m65" class="c0" points="0,0 1,0 1,1"/>
  <polygon id="m66" class="c0" points="0,0 1,0 1,1"/>

  <circle id="0" cx="280" cy="92" r="28" class="place"/>
  <circle id="1" cx="340" cy="92" r="28" class="place"/>
  <circle id="2" cx="400" cy="92" r="28" class="place"/>
  <circle id="3" cx="460" cy="92" r="28" class="place"/>
  <circle id="4" cx="520" cy="92" r="28" class="place"/>
  <circle id="5" cx="250" cy="144" r="28" class="place"/>
  <circle id="6" cx="310" cy="144" r="28" class="place"/>
  <circle id="7" cx="370" cy="144" r="28" class="place"/>
  <circle id="8" cx="430" cy="144" r="28" class="place"/>
  <circle id="9" cx="490" cy="144" r="28" class="place"/>
  <circle id="10" cx="550" cy="144" r="28" class="place"/>
  <circle id="11" cx="220" cy="196" r="28" class="place"/>
  <circle id="12" cx="280" cy="196" r="28" class="place"/>
  <circle id="13" cx="340" cy="196" r="28" class="place"/>
  <circle id="14" cx="400" cy="196" r="28" class="place"/>
  <circle id="15" cx="460" cy="196" r="28" class="place"/>
  <circle id="16" cx="520" cy="196" r="28" class="place"/>
  <circle id="17" cx="580" cy="196" r="28" class="place"/>
  <circle id="18" cx="190" cy="248" r="28" class="place"/>
  <circle id="19" cx="250" cy="248" r="28" class="place"/>
  <circle id="20" cx="310" cy="248" r="28" class="place"/>
  <circle id="21" cx="370" cy="248" r="28" class="place"/>
  <circle id="22" cx="430" cy="248" r="28" class="place"/>
  <circle id="23" cx="490" cy="248" r="28" class="place"/>
  <circle id="24" cx="550" cy="248" r="28" class="place"/>
  <circle id="25" cx="610" cy="248" r="28" class="place"/>
  <circle id="26" cx="160" cy="300" r="28" class="place"/>
  <circle id="27" cx="220" cy="300" r="28" class="place"/>
  <circle id="28" cx="280" cy="300" r="28" class="place"/>
  <circle id="29" cx="340" cy="300" r="28" class="place"/>
  <circle id="30" cx="400" cy="300" r="28" class="place"/>
  <circle id="31" cx="460" cy="300" r="28" class="place"/>
  <circle id="32" cx="520" cy="300" r="28" class="place"/>
  <circle id="33" cx="580" cy="300" r="28" class="place"/>
  <circle id="34" cx="640" cy="300" r="28" class="place"/>
  <circle id="35" cx="190" cy="352" r="28" class="place"/>
  <circle id="36" cx="250" cy="352" r="28" class="place"/>
  <circle id="37" cx="310" cy="352" r="28" class="place"/>
  <circle id="38" cx="370" cy="352" r="28" class="place"/>
  <circle id="39" cx="430" cy="352" r="28" class="place"/>
  <circle id="40" cx="490" cy="352" r="28" class="place"/>
  <circle id="41" cx="550" cy="352" r="28" class="place"/>
  <circle id="42" cx="610" cy="352" r="28" class="place"/>
  <circle id="43" cx="220" cy="404" r="28" class="place"/>
  <circle id="44" cx="280" cy="404" r="28" class="place"/>
  <circle id="45" cx="340" cy="404" r="28" class="place"/>
  <circle id="46" cx="400" cy="404" r="28" class="place"/>
  <circle id="47" cx="460" cy="404" r="28" class="place"/>
  <circle id="48" cx="520" cy="404" r="28" class="place"/>
  <circle id="49" cx="580" cy="404" r="28" class="place"/>
  <circle id="50" cx="250" cy="456" r="28" class="place"/>
  <circle id="51" cx="310" cy="456" r="28" class="place"/>
  <circle id="52" cx="370" cy="456" r="28" class="place"/>
  <circle id="53" cx="430" cy="456" r="28" class="place"/>
  <circle id="54" cx="490" cy="456" r="28" class="place"/>
  <circle id="55" cx="550" cy="456" r="28" class="place"/>
  <circle id="56" cx="280" cy="508" r="28" class="place"/>
  <circle id="57" cx="340" cy="508" r="28" class="place"/>
  <circle id="58" cx="400" cy="508" r="28" class="place"/>
  <circle id="59" cx="460" cy="508" r="28" class="place"/>
  <circle id="60" cx="520" cy="508" r="28" class="place"/>
</g>
  <text x="610" y="580" fill="black" font-size="50%">© 2019 Mikko Levanto</text> 
</svg>
</td>
<td style="padding-right: 2px">
<h1>Ruuhka</h1>
<p style="line-height:220%">
<span id="l0" class="selected">HELPPO</span>
<span id="l1" class="enabled">HELPOHKO</span>
<span id="l2" class="enabled">VAIKEAHKO</span>
<span id="l3" class="enabled">VAIKEA</span><br/>
<span style="white-space:nowrap">Peli:
<input id="gameid" type="text" value="1" style="text-align:right" size="10">
</span>
</p>
<p>Jokaisella kulkijalla on p&auml;&auml;m&auml;&auml;r&auml;, mutta reitti
sinne ei ole selv&auml;. Auta kulkijoita, jotka eiv&auml;t muuten
p&auml;&auml;se perille. Tasolla HELPPO kaikki kulkijat, jotka eiv&auml;t p&auml;&auml;se liikkumaan, on merkitty renkaalla. Klikkaa (niin monta kertaa
kuin on tarpeen) jokaista, joka on menossa v&auml;&auml;r&auml;&auml;n
suuntaan. Voit my&ouml;s klikata p&auml;&auml;m&auml;&auml;r&auml;&auml;n, jolloin
kaikki sinne pyrkiv&auml;t kulkijat asettuvat samaan suuntaan.</p>
<table class="askel-box">
<tr>
<td id="askel" class="askel-enabled">ASKEL</td>
<td id="count">123</td>
</tr>
</table>
<p>Kun olet saanut kaikki kulkijat (tai ainakin
tarpeeksi monta) oikeaan suuntaa, klikkaa painiketta ASKEL. Toista kunnes
kaikki kulkijat ovat p&auml;&auml;sseet perille. Painikkeen vieress&auml; oleva
numero kertoo, montako kertaa olet klikannut. T&auml;m&auml; on tuloksesi, kun
pelin loppuessa n&auml;ytt&ouml;&ouml;n tulee sana VALMIS. Mit&auml;
v&auml;hemm&auml;n, sen parempi!</p>
<p>Kun taso HELPPO tuntuu liian helpolla, voit ennen seuraavaa peli&auml;
vaihtaa tasoa ylh&auml;&auml;ll&auml; olvilla painikkeilla. Silloin kulkijoita
on enemm&auml;n ja ruuhkaa osoittavia renkaita v&auml;hemm&auml;n eik&auml;
tasolla VAIKEA ollenkaan. Lis&auml;&auml; vaihtelua saat kirjoittamalla
kentt&auml;&auml;n Peli numeron 1 paikalle jotain muuta.</p>
</td>
</tr>
</table>
<script>

(function(undefined) {

//  var GAME = document.getElementById("game");

//

// configuration tables

  var placeX = [
          280, 340, 400, 460, 520, 250, 310, 370, 430, 490, 
          550, 220, 280, 340, 400, 460, 520, 580, 190, 250, 
          310, 370, 430, 490, 550, 610, 160, 220, 280, 340, 
          400, 460, 520, 580, 640, 190, 250, 310, 370, 430, 
          490, 550, 610, 220, 280, 340, 400, 460, 520, 580, 
          250, 310, 370, 430, 490, 550, 280, 340, 400, 460, 
          520, 550, 700, 550, 250, 100, 250 ];

  var placeY = [
           92,  92,  92,  92,  92, 144, 144, 144, 144, 144, 
          144, 196, 196, 196, 196, 196, 196, 196, 248, 248, 
          248, 248, 248, 248, 248, 248, 300, 300, 300, 300, 
          300, 300, 300, 300, 300, 352, 352, 352, 352, 352, 
          352, 352, 352, 404, 404, 404, 404, 404, 404, 404, 
          456, 456, 456, 456, 456, 456, 508, 508, 508, 508, 
          508,  40, 300, 560, 560, 300,  40 ];

  var placeNext = [
          null,
          [ -1, -1, -1, -1, 61,  0,  1,  2,  3,  4,
            -1,  5,  6,  7,  8,  9, 10, -1, 11, 12,
            13, 14, 15, 16, 17, -1, 18, 19, 20, 21,
            22, 23, 24, 25, -1, 27, 28, 29, 30, 31,
            32, 33, 34, 36, 37, 38, 39, 40, 41, 42,
            44, 45, 46, 47, 48, 49, 51, 52, 53, 54,
            55, -1, -1, -1, 56, -1, -1 ],
          [  1,  2,  3,  4, -1,  6,  7,  8,  9, 10,
            -1, 12, 13, 14, 15, 16, 17, -1, 19, 20,
            21, 22, 23, 24, 25, -1, 27, 28, 29, 30,
            31, 32, 33, 34, 62, 36, 37, 38, 39, 40,
            41, 42, -1, 44, 45, 46, 47, 48, 49, -1,
            51, 52, 53, 54, 55, -1, 57, 58, 59, 60,
            -1, -1, -1, -1, -1, 26, -1 ],
          [  6,  7,  8,  9, 10, 12, 13, 14, 15, 16,
            17, 19, 20, 21, 22, 23, 24, 25, 27, 28,
            29, 30, 31, 32, 33, 34, 35, 36, 37, 38,
            39, 40, 41, 42, -1, 43, 44, 45, 46, 47,
            48, 49, -1, 50, 51, 52, 53, 54, 55, -1,
            56, 57, 58, 59, 60, -1, -1, -1, -1, -1,
            63, -1, -1, -1, -1, -1,  0 ],
          [  5,  6,  7,  8,  9, 11, 12, 13, 14, 15,
            16, 18, 19, 20, 21, 22, 23, 24, 26, 27,
            28, 29, 30, 31, 32, 33, -1, 35, 36, 37,
            38, 39, 40, 41, 42, -1, 43, 44, 45, 46,
            47, 48, 49, -1, 50, 51, 52, 53, 54, 55,
            -1, 56, 57, 58, 59, 60, 64, -1, -1, -1,
            -1,  4, -1, -1, -1, -1, -1 ],
          [ -1,  0,  1,  2,  3, -1,  5,  6,  7,  8,
             9, -1, 11, 12, 13, 14, 15, 16, -1, 18,
            19, 20, 21, 22, 23, 24, 65, 26, 27, 28,
            29, 30, 31, 32, 33, -1, 35, 36, 37, 38,
            39, 40, 41, -1, 43, 44, 45, 46, 47, 48,
            -1, 50, 51, 52, 53, 54, -1, 56, 57, 58,
            59, -1, 34, -1, -1, -1, -1 ],
          [ 66, -1, -1, -1, -1, -1,  0,  1,  2,  3,
             4, -1,  5,  6,  7,  8,  9, 10, -1, 11,
            12, 13, 14, 15, 16, 17, -1, 18, 19, 20,
            21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
            31, 32, 33, 35, 36, 37, 38, 39, 40, 41,
            43, 44, 45, 46, 47, 48, 50, 51, 52, 53,
            54, -1, -1, 60, -1, -1, -1 ] ];

  var markShape = [
        [   1  ,  1  ,  -1  ,  1  ,  -1  , -1  ,   1  , -1   ],
        [  11.3,-19.5,   3.8, 19.5,  -3.8,  6.5, -18.8,  6.5 ],  
        [  22.5,  0.0, -15.0, 13.0,  -7.5,  0.0, -15.0,-13.0 ],
        [  11.3, 19.5, -18.8, -6.5,  -3.8, -6.5,   3.8,-19.5 ],
        [ -11.3, 19.5,  -3.8,-19.5,   3.8, -6.5,  18.8, -6.5 ],
        [ -22.5,  0.0,  15.0,-13.0,   7.5,  0.0,  15.0, 13.0 ],
        [ -11.3,-19.5,  18.8,  6.5,   3.8,  6.5,  -3.8, 19.5 ] ];

  var animX = [ 0, 30, 60, 30,-30,-60,-30 ];
  var animY = [ 0,-52, 00, 52, 52, 00,-52 ];

  var initDir = [
        [ 3, 0,-1, 0, 4, 0, 0, 0, 0, 0,
          0,-1, 0,-1, 0,-1, 0,-1, 0, 0,
          0, 0, 0, 0, 0, 0, 2, 0,-1, 0,
         -1, 0,-1, 0, 5, 0, 0, 0, 0, 0,
          0, 0, 0,-1, 0,-1, 0,-1, 0,-1,
          0, 0, 0, 0, 0, 0, 1, 0,-1, 0,
          6 ],
        [ 3, 0, 0, 0, 4, 0, 0,-1,-1, 0,
          0, 0,-1,-1,-1,-1,-1, 0, 0,-1,
         -1,-1,-1,-1,-1, 0, 2, 0,-1,-1,
         -1,-1,-1, 0, 5, 0,-1,-1,-1,-1,
         -1,-1, 0, 0,-1,-1,-1,-1,-1, 0,
          0, 0,-1,-1, 0, 0, 1, 0, 0, 0,
          6 ],
        [ 3,-1,-1,-1, 4,-1, 0,-1,-1, 0,
         -1,-1,-1, 0,-1, 0,-1,-1,-1,-1,
         -1,-1,-1,-1,-1,-1, 2, 0, 0,-1,
          0,-1, 0, 0, 5,-1,-1,-1,-1,-1,
         -1,-1,-1,-1,-1, 0,-1, 0,-1,-1,
         -1, 0,-1,-1, 0,-1, 1,-1,-1,-1,
          6 ],
        [ 3, 3,-1, 4, 4, 3, 3,-1,-1, 4,
          4,-1,-1,-1,-1,-1,-1,-1, 2,-1,
         -1,-1,-1,-1,-1, 5, 2, 2,-1,-1,
         -1,-1,-1, 5, 5, 2,-1,-1,-1,-1,
         -1,-1, 5,-1,-1,-1,-1,-1,-1,-1,
          1, 1,-1,-1, 6, 6, 1, 1,-1, 6,
          6 ] ];

  var colorCode = [ "c0", "c1", "c2", "c3", "c4", "c5", "c6" ];

// Display elements

  var PLACE = [];

  for (var xin = 0; xin < 61; xin++) {
    PLACE[xin] = document.getElementById(""+xin);
    PLACE[xin].onmouseover = inTurn;
    PLACE[xin].onmousedown = doTurn;
    PLACE[xin].onmouseout = outTurn;
  }

  var MARK = [];

  for (var xin = 0; xin < 67; xin++) {
    MARK[xin] = document.getElementById("m"+xin);
  }

  var GOAL = [ null,
               document.getElementById("g1"),
               document.getElementById("g2"),
               document.getElementById("g3"),
               document.getElementById("g4"),
               document.getElementById("g5"),
               document.getElementById("g6") ];
  for (var xin = 1; xin < 7; xin++) {
    GOAL[xin].onmouseover = inGoal;
    GOAL[xin].onmousedown = clickGoal;
    GOAL[xin].onmouseout = outGoal;
    MARK[60+xin].onmouseover = inGoal;
    MARK[60+xin].onmousedown = clickGoal;
    MARK[60+xin].onmouseout = outGoal;
  }

  var L0 = document.getElementById("l0");
  L0.onmousedown = pressLevel;
  L0.onmouseup = releaseLevel;
  L0.onmouseout = releaseLevel;
  var L1 = document.getElementById("l1");
  L1.onmousedown = pressLevel;
  L1.onmouseup = releaseLevel;
  L1.onmouseout = releaseLevel;
  var L2 = document.getElementById("l2");
  L2.onmousedown = pressLevel;
  L2.onmouseup = releaseLevel;
  L2.onmouseout = releaseLevel;
  var L3 = document.getElementById("l3");
  L3.onmousedown = pressLevel;
  L3.onmouseup = releaseLevel;
  L3.onmouseout = releaseLevel;
  var LEVEL = [L0, L1, L2, L3];

  var GAMEID = document.getElementById("gameid");
  GAMEID.oninput = setGameId;

  var ASKEL = document.getElementById("askel");
  ASKEL.onmousedown = doMove;
  ASKEL.onmouseup = outMove;
  ASKEL.onmouseout = outMove;

  var COUNT = document.getElementById("count");

  var VALMIS = document.getElementById("valmis");

// Game state

  var gameStatus = 0;
  var level = 0;

  var markDir = [];
  var markColor = [];
  var markFr = [];

  var count = 0;

  var timer = null;
  var time_left = 0;

// Pseudo-random numbers

  var last_random = 0;

  var first_random
         = [ 0x1111111120ae, 0x222222222293, 0x33333333333d, 0x444444444449 ];

  function reset_random() {
    last_random = first_random[level];
    var seed = GAMEID.value;
    var first = true;
    for (var i = 0; i < seed.length; i++) {
      var c = seed.charCodeAt(i);
      if (c > 0x20 && (!first || c != 0x30) && c != 0x5f) {
        if (c == 0x2c) c = 0x2e;
        last_random = ((last_random + c) * 0x810500020001) % 0x7ffffffffff;
      }
    }
  }

  function random() {
    last_random = (257 * last_random + 1) & 0x7fffffff;
    return last_random / 0x80000000;
  }

// Game actions

  function inTurn() {
    var color = markColor[Number(this.id)];
    for (var xin = 6; xin > 0; xin--) {
      if (xin != color) {
        GOAL[xin].setAttribute("stroke-width", 8);
      } else {
        GOAL[xin].setAttribute("stroke-width", 0);
      }
    }
  }

  function outTurn() {
    var color = markColor[Number(this.id)];
    for (var xin = 6; xin > 0; xin--) {
      GOAL[xin].setAttribute("stroke-width", 8);
    }
  }

  function inGoal() {
    var color = Number(this.id.substring(1));
    if (color > 60) color = color - 60;
    for (var xin = 0; xin < 61; xin++) {
      if (markColor[xin] == color) {
        PLACE[xin].setAttribute("class","place-strong");
      } else {
        PLACE[xin].setAttribute("class","place");
      }
    }
  }

  function clickGoal() {
    var color = Number(this.id.substring(1));
    if (color > 60) color = color - 60;
    for (var xin = 0; xin < 61; xin++) {
      if (markColor[xin] == color) {
        var dir = color;
        if (placeNext[dir][xin] < 0) {
          dir = 1 + (dir % 6);
          if (placeNext[dir][xin] < 0 || placeNext[dir][xin] > 60) {
            dir = 1 + ((dir + 3) % 6);
          }
        }
        markDir[xin] = dir;
        setMark(xin);
      }
    }
  }

  function outGoal() {
    checkMoves();
  }

  function setMark(xin) {
    var color = markColor[xin];
    var dir = markDir[xin];
    if (color > 0 && dir > 0) {
      var dist = (markFr[xin] > -1 ? time_left : 0);
      var shape = markShape[dir];
      var points = "";
      for (var i = 1; i < shape.length; i = i+2) {
        var x = placeX[xin] + shape[i-1] - dist * animX[dir] / 25;
        var y = placeY[xin] + shape[i] - dist * animY[dir] / 25;
        points += " "+x.toFixed(1)+","+y.toFixed(1);
      }
      MARK[xin].setAttribute("points", points);
    }
    MARK[xin].setAttribute("class", colorCode[color]);
  }

  function checkMoves() {
    for (var xin = 0; xin < 67; xin++) {
      markFr[xin] = -1;
    }
    for (var xin = 0; xin < 61; xin++) {
      var dir = markDir[xin];
      if (dir != 0) {
        var pos = xin;
        var pos2 = -1;
        var nxt = placeNext[dir][xin];
        var nxtDir = (nxt < 0 ? 0 : markDir[nxt]);
        if (  (nxt < 0 || (nxt > 60 && dir != markColor[xin]))
           || (dir != 0 && nxtDir != 0 && (9 + dir - nxtDir) % 6 == 0)  )
        {
          pos = markFr[xin];
          if (pos < 0) {
            markFr[xin] = -4;
          } else {
            markFr[xin] = -3;
          }
        } else {
          var nxtFr = markFr[nxt];
          if (nxtFr > -1) {
            pos2 = nxtFr;
            markFr[nxt] = -2;
          } else if (nxtFr == -1) {
            markFr[nxt] = xin;
            pos = -1;
          } else {
            if (nxtFr == -6) {
              markFr[nxt] = -5;
            } else if (nxtFr < -3) {
              markFr[nxt] = -3;
            }
          }
        }
        while (pos > -1) {
          var prv = markFr[pos];
          if (prv > -1) {
            markFr[pos] = -5;
          } else if (prv == -1) {
            markFr[pos] = -6;
          } else if (prv == -2) {
            markFr[pos] = -3;
          }
          if (prv < 0) {
            pos = pos2;
            pos2 = -1;
          } else {
            pos = prv;
          }
        }
      }
    }
    for (var xin = 0; xin < 61; xin++) {
      var xinFr = markFr[xin];
      var indication = (xinFr > -2 ? -1 : xinFr > -4 ? 2 : xinFr > -5 ? 1 : 0);
      PLACE[xin].setAttribute("class", indication < level ? "place" :
            indication == level ? "place-weak" : "place-strong");
    }
  }

  function doTurn() {
    if (timer == null) {
      var xin = Number(this.id);
      if (markDir[xin] > 0) {
        markDir[xin] = 1 + (markDir[xin] % 6);
      }
      setMark(xin);
      checkMoves();
    }
  }

  function doMove() {
    if (gameStatus < 2 && time_left == 0) {
      if (gameStatus < 1) {
        setStatus(1);
      }
      ASKEL.setAttribute("class", "askel-pressed");
      count++;
      COUNT.innerHTML = count;
      var oldDir = markDir;
      var oldColor = markColor;
      markDir = [];
      markColor = [];
      time_left = 24;
      for (var xin = 0; xin < 67; xin++) {
        if (markFr[xin] > -1) {
          markDir[xin] = oldDir[markFr[xin]];
          markColor[xin] = oldColor[markFr[xin]];      
        } else if (markFr[xin] > -3) {
          markDir[xin] = 0;
          markColor[xin] = 0;
        } else {
          markDir[xin] = oldDir[xin];
          markColor[xin] = oldColor[xin];
        }
        setMark(xin);
      }
      timer = setInterval(doAnimation, 40);
    }
  }

  function outMove() {
    if (gameStatus < 2) {
      ASKEL.setAttribute("class", "askel-enabled");
    }
  }

  function doAnimation() {
    if (timer != null) {
      time_left--;
      if (time_left > 0) {
        for (var xin = 0; xin < 67; xin++) {
          setMark(xin);
        }
      } else {
        clearInterval(timer);
        timer = null;
        checkMoves();
        var remaining_cnt = 0;
        for (var xin = 0; xin < 67; xin++) {
          if (xin < 61 && markColor[xin] > 0) {
            remaining_cnt++;
          }
          setMark(xin);
        }
        if (remaining_cnt == 0) {
          setStatus(2);
        }
      }
    }
  }

// Setup functions

  function reset(newLevel) {
    level = newLevel;
    if (level < 0) {
      level = 0;
    } else if (newLevel >= initDir.length) {
      level = initDir.length - 1;
    }
    setStatus(0);
    reset_random();
    resetDir = initDir[level];
    for (var xin = 0; xin < 61; xin++) {
      var dir = resetDir[xin];
      if (dir < 0) {
        dir = 1 + Math.floor((6 - (dir + 1)/10) * random());
        if (dir > 6) dir = 0;
      }
      markDir[xin] = dir;
    }
    for (var xin = 61; xin < 67; xin++) {
      markDir[xin] = xin - 60;
    }
    for (var xin = 0; xin < 67; xin++) {
      markColor[xin] = markDir[xin];
      markFr[xin] = -2;
      setMark(xin);
    }
    checkMoves();
  }

  function pressLevel() {
    if (gameStatus != 1) {
      reset(Number(this.id.substring(1)));
      LEVEL[level].setAttribute("class", "pressed");
    }
  }

  function releaseLevel() {
    if (gameStatus != 1) {
      LEVEL[level].setAttribute("class", "selected");
    }
  }

  function setGameId() {
    if (gameStatus != 1) {
      reset(level);
    }
  }

  function setStatus(status) {
    GAMEID.disabled = (status == 1);
    if (status < 2) {
      ASKEL.setAttribute("class", "askel-enabled");
      count = 0;
      COUNT.innerHTML = "0";
      VALMIS.setAttribute("fill", "black");
      if (status == 1) {
        LEVEL[level].setAttribute("class", "used");
      }
    } else {
      ASKEL.setAttribute("class", "askel-disabled");
      VALMIS.setAttribute("fill", "yellow");
      LEVEL[level].setAttribute("class", "selected");
    }    
    gameStatus = status;
    for (var i = 0; i < LEVEL.length; i++) {
      if (i != level) {
        LEVEL[i].setAttribute("class", status == 1 ? "disabled" : "enabled");
      }
    }
  }

// start game;

  reset(0);

//


})();

</script>
</body>
</html>
